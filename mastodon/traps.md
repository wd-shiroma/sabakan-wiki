<!-- TITLE: マストドン構築・運用時の罠 -->
<!-- SUBTITLE: マストドン構築・運用時の罠の紹介 -->

# 外部に公開する前に十分注意を
マストドンを外部のインスタンスと連携している状態（ユーザがインスタンスを越えてフォローしあっている状態）になると、
相手側のインスタンスに自分のインスタンスの情報を登録することになります。
自分のインスタンスでデータの細かな修正を行うことはできますが、相手方のインスタンスのデータベースを変更してもらうことは極めて困難です。
そうなる前に他のインスタンスと連携している状態になるまえに、十分に設定を確認しましょう。
以下は、その観点から特に注意しておくべき点です。

## LOCAL_DOMAINに大文字(Upper Case)を使用しない
DNSのドメイン名はcase insensitive(大文字・小文字を区別しない)ですが、マストドン内部ではcase sensitive(大文字・小文字を区別する)です。
マストドンsetup時にドメイン名を大文字・小文字が混在した状態でインスタンスを公開した場合、思わぬ問題を招きますのでおすすめできません。
また、あとからLOCAL_DOMAINをlower-case(すべて小文字)に変えることもできません。
ドメイン名はマストドン設定初期状態からすべてlower-caseで統一することをおすすめします。設定する際は十分注意しましょう。

## データベース(PostgreSQL)の重要性
サーバ間でやりとりされるトゥートには鍵が埋め込まれており、ユーザの同一性を保証しているようです。
そのため、他のインスタンスと連携状態になったあと、そのドメインで運用していたインスタンスのデータベースを削除した場合、
その前に存在していた同じドメイン・同じユーザは、他のインスタンスからは違うユーザと認識されるため、
他のインスタンスと正しく通信できなくなる可能性があります。公開後にデータベースを削除する際は十分に注意しましょう。
